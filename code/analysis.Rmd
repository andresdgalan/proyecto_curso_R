---
title: "proyecto"
author: "Lidia y Andr√©s"
date: "21/09/2022"
output: word_document
---

```{r library and data, include=FALSE}
#packages for modelling and visualization
library(MuMIn)
library(DHARMa)
library(ggplot2)
library(mgcv) 
library(tidymv) 
library(visreg) 
library(mgcViz) 
library(dplyr)
library(here)
library(readr)

#subir datos de DIVERSIFICA

DIVERSIFICA.plot <- read_delim(here("data/st.DIVERSIFICA.plot.csv"), delim = ";")
DIVERSIFICA.plot <- DIVERSIFICA.plot[-27, ]
DIVERSIFICA.plot$DBH2 <- DIVERSIFICA.plot$DBH^2

DIVERSIFICA.tree <- read_delim(here("data/st.DIVERSIFICA.tree.strange.csv"), delim = ";")
```

```{r Linear Model, echo=FALSE}
plotModel<- lm (def ~ DBH + DBH2 + mycrhz + NO3 + comp, data = DIVERSIFICA.plot, na.action = na.fail)

#to compare all possible models with AIC
res <- dredge(plotModel, trace=0)

#to keep only the best models and visualize them
subset(res, delta <= 2)

#to see the error of the estimate and the significance of the effect
summary(model.avg(res, subset = delta < 2, revised.var=FALSE))

#to see the importance of each variable
sw(subset(model.sel(res), delta <= 2))

#Paquete DHARMA
simulateResiduals(plotModel, plot = TRUE)
```

```{r plotting}
visreg(plotModel)
visreg(plotModel, gg=T) + geom_smooth(formula = lm(def ~ DBH + DBH2 + comp + mycrhz), data = DIVERSIFICA.plot)

#cogido de internet cambiando el nombre de las variables (la secuencia de valores de DBH no tiene sentido, le pongo numeros con sentido)
DBHvalues <- seq(0, 30, 0.1)
predicteddef <- predict(plotModel,list(DBH=DBHvalues, DBH2=DBHvalues^2))
plot(DBH, def, pch=16, xlab = "DBH (cm)", ylab = "Defoliation (%)", cex.lab = 1.3, col = "blue")
lines(DBHvalues, predicteddef, col = "darkgreen", lwd = 3)

#probando a cambiar la secuencia por el vector de DBH
DBHvalues <- seq(-1.305547, 1.786487, 0.01)
predicteddef <- predict(plotModel)
plot(DIVERSIFICA.plot$DBH, DIVERSIFICA.plot$def, pch=16, xlab = "DBH (cm)", ylab = "Defoliation (%)", cex.lab = 1.3, col = "blue")
lines(DBHvalues, predicteddef, col = "darkgreen", lwd = 3)

range(DIVERSIFICA.plot$DBH)

```

-   
